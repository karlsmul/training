<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Kreuzheben - Krafttrainings App</title>

    <!-- PWA Meta Tags -->
    <meta name="description" content="Kreuzheben - Tracke deine Krafttrainings-Einheiten und pers√∂nlichen Bestleistungen">
    <meta name="theme-color" content="#1a0033">

    <!-- iOS Specific Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Kreuzheben">
    <link rel="apple-touch-icon" href="icon.svg">

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">

    <!-- Icons -->
    <link rel="icon" type="image/svg+xml" href="icon.svg">

    <link rel="stylesheet" href="style.css?v=43">
</head>
<body>
    <div class="container">
        <header>
            <div class="logo-container">
                <img src="logo.png" alt="Kreuzheben Logo" class="app-logo">
            </div>
            <h1>KREUZHEBEN</h1> 

            <p class="date" id="currentDate"></p>

            <!-- Sync Status -->
            <div class="sync-container">
                <span id="syncIcon" class="sync-icon">üîì</span>
                <span id="syncStatus" class="sync-status not_logged_in">Anmelden f√ºr Cloud-Sync</span>
            </div>

            <!-- Manual Update Button -->
            <div class="update-container">
                <button id="updateButton" class="btn-update" title="Ansicht aktualisieren">
                    üîÑ Aktualisieren
                </button>
                <span id="updateIndicator" class="update-indicator" style="display: none;">Neue Daten verf√ºgbar</span>
            </div>

            <!-- User Info / Login Button -->
            <div id="userInfo" class="user-info">
                <button class="btn-login" id="loginButton">Anmelden f√ºr Cloud-Sync</button>
            </div>
        </header>

        <main>
            <section class="input-section">
                <h2 id="formTitle">Neues Training eintragen</h2>
                <form id="trainingForm">
                    <div class="form-group">
                        <label for="exercise">√úbung:</label>
                        <select id="exercise" required>
                            <option value="">-- √úbung ausw√§hlen --</option>
                            <!-- Wird dynamisch gef√ºllt -->
                        </select>
                    </div>

                    <!-- Toggle zwischen Gewicht und Zeit -->
                    <div class="form-group">
                        <label>Trainingsart:</label>
                        <div class="training-type-toggle">
                            <button type="button" class="toggle-btn active" data-type="weight">‚öñÔ∏è Gewicht</button>
                            <button type="button" class="toggle-btn" data-type="time">‚è±Ô∏è Zeit</button>
                        </div>
                    </div>

                    <!-- Gewicht Input -->
                    <div class="form-group" id="weightGroup">
                        <label for="weight">Gewicht (kg):</label>
                        <input type="number" id="weight" step="0.5" placeholder="z.B. 80">
                        <div class="form-checkbox">
                            <input type="checkbox" id="differentWeights">
                            <label for="differentWeights">Unterschiedliche Gewichte pro Satz</label>
                        </div>
                    </div>

                    <!-- Zeit Input (versteckt) -->
                    <div class="form-group" id="timeGroup" style="display: none;">
                        <label for="time">Zeit:</label>
                        <div class="time-input-group">
                            <input type="number" id="timeMinutes" min="0" placeholder="Min" style="width: 48%;">
                            <input type="number" id="timeSeconds" min="0" max="59" placeholder="Sek" style="width: 48%;">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="sets">Anzahl S√§tze:</label>
                        <input type="number" id="sets" min="1" max="10" value="4" required>
                    </div>

                    <!-- Wiederholungen pro Satz -->
                    <div class="form-group">
                        <label>Wiederholungen pro Satz:</label>
                        <div id="repsInputs" class="reps-inputs">
                            <!-- Dynamisch generiert -->
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="date">Datum:</label>
                        <input type="date" id="date" required>
                    </div>

                    <div class="form-buttons">
                        <button type="submit" class="btn-primary" id="submitBtn">Eintrag hinzuf√ºgen</button>
                        <button type="button" class="btn-cancel" id="cancelBtn" style="display: none;">Abbrechen</button>
                    </div>
                </form>
            </section>

            <section class="history-section">
                <!-- Tab Navigation -->
                <div class="tab-navigation">
                    <button class="tab-btn active" data-tab="history">üìä Historie</button>
                    <button class="tab-btn" data-tab="plan">üìã Plan</button>
                    <button class="tab-btn" data-tab="stats">üìà Auswertung</button>
                    <button class="tab-btn" data-tab="records">üèÜ PRs</button>
                    <button class="tab-btn" data-tab="settings">‚öôÔ∏è Einstellungen</button>
                    <button class="tab-btn" data-tab="info">‚ÑπÔ∏è Info</button>
                </div>

                <!-- Training History Tab -->
                <div id="historyTab" class="tab-content active">
                    <div class="history-header">
                        <h2>Trainingshistorie</h2>
                        <button id="clearHistory" class="btn-secondary">Alle l√∂schen</button>
                    </div>

                    <div class="filter-section">
                        <input type="text" id="searchExercise" placeholder="Suche: Bankdr√ºcken oder Bankdr√ºcken 80">
                        <select id="historyDateSelect">
                            <!-- Wird dynamisch gef√ºllt -->
                        </select>
                    </div>

                    <div id="trainingList" class="training-list"></div>
                </div>

                <!-- Training Plan Tab - Einfache √úbungsdaten -->
                <div id="planTab" class="tab-content">
                    <div class="plan-header">
                        <h2>Trainingsplan</h2>
                        <p class="plan-subtitle">Gewichte, S√§tze und Wiederholungen pro √úbung</p>
                    </div>

                    <!-- Neuen Eintrag hinzuf√ºgen -->
                    <form id="planEntryForm" class="plan-entry-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="planExercise">√úbung</label>
                                <select id="planExercise" required>
                                    <option value="">-- √úbung w√§hlen --</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row three-col">
                            <div class="form-group">
                                <label for="planWeight">Gewicht (kg)</label>
                                <input type="number" id="planWeight" step="0.5" min="0" placeholder="z.B. 60">
                            </div>
                            <div class="form-group">
                                <label for="planSets">S√§tze</label>
                                <input type="number" id="planSets" min="1" placeholder="z.B. 3">
                            </div>
                            <div class="form-group">
                                <label for="planReps">Wdh.</label>
                                <input type="number" id="planReps" min="1" placeholder="z.B. 10">
                            </div>
                        </div>
                        <button type="submit" class="btn-primary">Speichern</button>
                    </form>

                    <!-- √úbung anzeigen -->
                    <div class="plan-view-section">
                        <div class="form-group">
                            <label for="planViewExercise">Eintr√§ge anzeigen f√ºr:</label>
                            <select id="planViewExercise">
                                <option value="">-- √úbung w√§hlen --</option>
                            </select>
                        </div>
                    </div>

                    <!-- Liste der Eintr√§ge (gefiltert) -->
                    <div id="planList" class="plan-list">
                        <!-- Wird dynamisch gef√ºllt -->
                    </div>
                </div>

                <!-- Personal Records Tab -->
                <div id="recordsTab" class="tab-content">
                    <div class="records-header">
                        <h2>Pers√∂nliche Bestleistungen</h2>
                        <p class="records-subtitle">Die Big 3 √úbungen</p>
                    </div>

                    <div id="recordsList" class="records-list">
                        <!-- Personal Records werden hier angezeigt -->
                    </div>
                </div>

                <!-- Statistics Tab -->
                <div id="statsTab" class="tab-content">
                    <div class="stats-header">
                        <h2>Auswertung & Statistiken</h2>
                    </div>

                    <!-- Trainingsh√§ufigkeit -->
                    <div class="stats-cards">
                        <div class="stat-card">
                            <div class="stat-icon">üìÖ</div>
                            <div class="stat-label">Trainingstage diesen Monat</div>
                            <div class="stat-value" id="monthlyTrainings">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">üìä</div>
                            <div class="stat-label">Durchschnitt pro Monat</div>
                            <div class="stat-value" id="avgMonthlyTrainings">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">üí™</div>
                            <div class="stat-label">Gesamt Trainingstage</div>
                            <div class="stat-value" id="totalTrainings">0</div>
                        </div>
                    </div>

                    <!-- K√∂rpergewicht Chart -->
                    <div class="chart-container">
                        <h3>K√∂rpergewicht-Entwicklung</h3>
                        <canvas id="bodyWeightChart"></canvas>
                    </div>
                </div>

                <!-- Settings Tab -->
                <div id="settingsTab" class="tab-content">
                    <div class="settings-header">
                        <h2>Einstellungen</h2>
                    </div>

                    <!-- √úbungsverwaltung -->
                    <div class="settings-section">
                        <h3>√úbungsverwaltung</h3>
                        <p style="color: #666; font-size: 0.9rem; margin-bottom: 15px;">
                            Verwalte deine √úbungsliste f√ºr das Dropdown-Men√º
                        </p>

                        <form id="exerciseForm">
                            <div class="form-row">
                                <div class="form-group" style="flex: 1;">
                                    <label for="newExercise">Neue √úbung:</label>
                                    <input type="text" id="newExercise" placeholder="z.B. Bankdr√ºcken">
                                </div>
                                <div style="display: flex; align-items: flex-end;">
                                    <button type="submit" class="btn-primary">Hinzuf√ºgen</button>
                                </div>
                            </div>
                        </form>

                        <!-- Ausklappbare √úbungsliste -->
                        <details class="exercise-details">
                            <summary id="exerciseSummary">Gespeicherte √úbungen anzeigen (0)</summary>
                            <div id="exerciseList" class="exercise-list">
                                <!-- √úbungsliste wird hier angezeigt -->
                            </div>
                        </details>
                    </div>

                    <!-- K√∂rperdaten -->
                    <div class="settings-section">
                        <h3>K√∂rperdaten</h3>
                        <form id="bodyDataForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="bodyWeight">K√∂rpergewicht (kg):</label>
                                    <input type="number" id="bodyWeight" step="0.1" placeholder="z.B. 75.5">
                                </div>
                                <div class="form-group">
                                    <label for="bodyWeightDate">Datum:</label>
                                    <input type="date" id="bodyWeightDate" required>
                                </div>
                            </div>
                            <button type="submit" class="btn-primary">Gewicht hinzuf√ºgen</button>
                        </form>

                        <!-- Zielgewicht -->
                        <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #e0e0e0;">
                            <div class="form-group">
                                <label for="targetWeight">Zielgewicht (kg):</label>
                                <input type="number" id="targetWeight" step="0.1" placeholder="Optional">
                                <button onclick="saveTargetWeight()" class="btn-primary" style="margin-top: 10px;">Zielgewicht speichern</button>
                            </div>
                        </div>

                        <!-- Gewichtshistorie ausgeblendet, Daten bleiben gespeichert -->
                        <div id="bodyWeightHistory" class="body-weight-history" style="display: none;">
                        </div>
                    </div>

                    <!-- Konto-Einstellungen (nur wenn angemeldet) -->
                    <div id="accountSettings" class="settings-section" style="display: none;">
                        <h3>Konto</h3>
                        <div id="accountInfo" style="margin-bottom: 15px;">
                            <p><strong>E-Mail:</strong> <span id="accountEmail">-</span></p>
                            <p><strong>Status:</strong> <span id="accountVerified">-</span></p>
                        </div>

                        <!-- Passwort √§ndern -->
                        <details class="password-change-details">
                            <summary>Passwort √§ndern</summary>
                            <form id="changePasswordForm" style="margin-top: 15px;">
                                <div class="form-group">
                                    <label for="currentPassword">Aktuelles Passwort:</label>
                                    <input type="password" id="currentPassword" required minlength="6" autocomplete="current-password">
                                </div>
                                <div class="form-group">
                                    <label for="newPassword">Neues Passwort:</label>
                                    <input type="password" id="newPassword" required minlength="6" autocomplete="new-password" placeholder="Mind. 6 Zeichen">
                                </div>
                                <div class="form-group">
                                    <label for="confirmNewPassword">Neues Passwort best√§tigen:</label>
                                    <input type="password" id="confirmNewPassword" required minlength="6" autocomplete="new-password">
                                </div>
                                <button type="submit" class="btn-primary">Passwort √§ndern</button>
                            </form>
                        </details>

                        <!-- Verifizierungs-E-Mail erneut senden -->
                        <div id="resendVerificationSection" style="margin-top: 15px; display: none;">
                            <button onclick="resendVerificationEmail()" class="btn-secondary">Verifizierungs-E-Mail erneut senden</button>
                        </div>
                    </div>

                    <!-- Datenschutz & Speicherung -->
                    <div id="storageModeSection" class="settings-section" style="display: none;">
                        <h3>Datenschutz & Speicherung</h3>
                        <p style="color: #666; font-size: 0.9rem; margin-bottom: 15px;">
                            W√§hle, wo deine Trainingsdaten gespeichert werden sollen.
                        </p>

                        <div class="storage-options">
                            <!-- Cloud Option -->
                            <label class="storage-option" id="cloudOption">
                                <input type="radio" name="storageMode" value="cloud" checked>
                                <div class="storage-option-content">
                                    <div class="storage-option-header">
                                        <span class="storage-icon">‚òÅÔ∏è</span>
                                        <span class="storage-title">Cloud-Speicherung</span>
                                        <span class="storage-badge recommended">Empfohlen</span>
                                    </div>
                                    <p class="storage-description">Daten werden sicher in der Cloud (Firebase) gespeichert.</p>
                                    <ul class="storage-features">
                                        <li class="feature-positive">Sync zwischen allen Ger√§ten</li>
                                        <li class="feature-positive">Automatische Backups</li>
                                        <li class="feature-positive">Daten sicher bei Ger√§teverlust</li>
                                    </ul>
                                </div>
                            </label>

                            <!-- Lokal Option -->
                            <label class="storage-option" id="localOption">
                                <input type="radio" name="storageMode" value="local">
                                <div class="storage-option-content">
                                    <div class="storage-option-header">
                                        <span class="storage-icon">üì±</span>
                                        <span class="storage-title">Nur lokale Speicherung</span>
                                    </div>
                                    <p class="storage-description">Daten werden nur auf diesem Ger√§t gespeichert.</p>
                                    <ul class="storage-features">
                                        <li class="feature-positive">Maximaler Datenschutz</li>
                                        <li class="feature-positive">Keine Cloud-Verbindung n√∂tig</li>
                                        <li class="feature-negative">Kein Sync zwischen Ger√§ten</li>
                                        <li class="feature-negative">Datenverlust bei Ger√§teverlust m√∂glich</li>
                                    </ul>
                                </div>
                            </label>
                        </div>

                        <p id="storageModeStatus" class="storage-status"></p>
                        <p style="color: #888; font-size: 0.8rem; margin-top: 10px;">
                            Hinweis: Bereits gespeicherte Daten werden nicht automatisch migriert.
                        </p>
                    </div>

                </div>

                <!-- Info Tab -->
                <div id="infoTab" class="tab-content">
                    <div class="info-header">
                        <h2>Datenspeicherung & Datenschutz</h2>
                    </div>

                    <!-- Einf√ºhrung -->
                    <div class="info-card">
                        <h3>Wie werden meine Daten gespeichert?</h3>
                        <p>
                            Kreuzheben verwendet <strong>Firebase Cloud Firestore</strong> von Google,
                            um deine Trainingsdaten sicher in der Cloud zu speichern. Zus√§tzlich werden deine Daten
                            lokal auf deinem Ger√§t zwischengespeichert, damit die App auch offline funktioniert.
                        </p>
                    </div>

                    <!-- Cloud-Speicherung -->
                    <div class="info-card cloud-card">
                        <h3>‚òÅÔ∏è Cloud-Speicherung (Firebase)</h3>

                        <div class="info-section">
                            <h4>Vorteile:</h4>
                            <ul class="info-list positive">
                                <li><strong>Ger√§te√ºbergreifend:</strong> Greife von jedem Ger√§t auf deine Daten zu - Handy, Tablet oder Computer.</li>
                                <li><strong>Automatische Backups:</strong> Deine Daten werden automatisch gesichert und gehen nicht verloren.</li>
                                <li><strong>Echtzeit-Synchronisierung:</strong> √Ñnderungen werden sofort auf allen Ger√§ten sichtbar.</li>
                                <li><strong>Offline-Funktion:</strong> Die App funktioniert auch ohne Internet dank lokalem Cache.</li>
                            </ul>
                        </div>

                        <div class="info-section">
                            <h4>Nachteile:</h4>
                            <ul class="info-list negative">
                                <li><strong>Daten auf fremden Servern:</strong> Deine Daten liegen auf Google-Servern (Firebase).</li>
                                <li><strong>Internet erforderlich:</strong> F√ºr die erste Anmeldung und Synchronisierung wird Internet ben√∂tigt.</li>
                                <li><strong>Abh√§ngigkeit vom Anbieter:</strong> Falls Firebase eingestellt wird, m√ºssten Daten migriert werden.</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Lokale Speicherung -->
                    <div class="info-card local-card">
                        <h3>üì± Lokale Speicherung (localStorage/IndexedDB)</h3>

                        <div class="info-section">
                            <h4>Vorteile:</h4>
                            <ul class="info-list positive">
                                <li><strong>Volle Kontrolle:</strong> Alle Daten bleiben nur auf deinem Ger√§t.</li>
                                <li><strong>Keine Internetverbindung n√∂tig:</strong> Die App funktioniert komplett offline.</li>
                                <li><strong>Maximale Privatsph√§re:</strong> Kein Drittanbieter hat Zugriff auf deine Trainingsdaten.</li>
                            </ul>
                        </div>

                        <div class="info-section">
                            <h4>Nachteile:</h4>
                            <ul class="info-list negative">
                                <li><strong>Kein Backup:</strong> Wenn du dein Ger√§t verlierst oder den Browser-Cache l√∂schst, sind die Daten weg.</li>
                                <li><strong>Nur ein Ger√§t:</strong> Daten sind nicht auf anderen Ger√§ten verf√ºgbar.</li>
                                <li><strong>Speicherlimit:</strong> Browser begrenzen den lokalen Speicherplatz.</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Aktuelle Konfiguration -->
                    <div class="info-card config-card">
                        <h3>Deine aktuelle Konfiguration</h3>
                        <p id="currentStorageInfo">
                            Kreuzheben nutzt derzeit die <strong>Cloud-Speicherung</strong> mit lokalem Cache.
                        </p>
                        <ul class="info-list neutral">
                            <li>Deine Daten werden sicher in Firebase gespeichert</li>
                            <li>Eine lokale Kopie erm√∂glicht Offline-Nutzung</li>
                            <li>√Ñnderungen werden automatisch synchronisiert, sobald du online bist</li>
                        </ul>
                        <p style="margin-top: 15px;">
                            Du kannst den Speichermodus in den <a href="#" onclick="switchToSettings()">Einstellungen</a> √§ndern.
                        </p>
                    </div>

                    <!-- Sicherheit -->
                    <div class="info-card security-card">
                        <h3>üîí Sicherheitshinweise</h3>
                        <ul class="info-list security">
                            <li>üîí Alle Daten werden √ºber verschl√ºsselte Verbindungen (HTTPS) √ºbertragen.</li>
                            <li>üë§ Jeder Nutzer kann nur seine eigenen Daten sehen - andere Nutzer haben keinen Zugriff.</li>
                            <li>üîë Verwende ein starkes Passwort mit Gro√ü-/Kleinbuchstaben, Zahlen und Sonderzeichen.</li>
                            <li>üì± Melde dich auf √∂ffentlichen Ger√§ten immer ab, um unbefugten Zugriff zu verhindern.</li>
                        </ul>
                    </div>

                    <p class="info-footer">
                        Bei Fragen zur Datenspeicherung wende dich an den App-Entwickler.
                    </p>
                </div>
            </section>
        </main>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="modal-close" id="modalClose">&times;</span>

            <!-- Login View -->
            <div id="loginView">
                <h2>üîê Anmelden</h2>
                <p>Melde dich an, um deine Trainings in der Cloud zu synchronisieren</p>

                <button id="googleLoginButton" class="btn-google">
                    <svg class="google-icon-svg" viewBox="0 0 24 24" width="20" height="20">
                        <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                        <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                        <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                        <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                    </svg>
                    Mit Google anmelden
                </button>

                <button id="appleLoginButton" class="btn-apple">
                    <svg class="apple-icon-svg" viewBox="0 0 24 24" width="20" height="20">
                        <path fill="currentColor" d="M17.05 20.28c-.98.95-2.05.8-3.08.35-1.09-.46-2.09-.48-3.24 0-1.44.62-2.2.44-3.06-.35C2.79 15.25 3.51 7.59 9.05 7.31c1.35.07 2.29.74 3.08.8 1.18-.24 2.31-.93 3.57-.84 1.51.12 2.65.72 3.4 1.8-3.12 1.87-2.38 5.98.48 7.13-.57 1.5-1.31 2.99-2.54 4.09l.01-.01zM12.03 7.25c-.15-2.23 1.66-4.07 3.74-4.25.29 2.58-2.34 4.5-3.74 4.25z"/>
                    </svg>
                    Mit Apple anmelden
                </button>

                <div class="divider">
                    <span>oder</span>
                </div>

                <form id="emailLoginForm">
                    <div class="form-group">
                        <input type="email" id="loginEmail" placeholder="E-Mail" required autocomplete="email">
                    </div>
                    <div class="form-group">
                        <input type="password" id="loginPassword" placeholder="Passwort" required autocomplete="current-password" minlength="6">
                    </div>
                    <div id="loginError" class="auth-error" style="display: none;"></div>
                    <button type="submit" class="btn-primary" id="loginSubmitBtn">Anmelden</button>
                </form>

                <p class="modal-footer">
                    Noch kein Konto? <a href="#" id="registerLink">Registrieren</a>
                    <br>
                    <a href="#" id="forgotPasswordLink">Passwort vergessen?</a>
                </p>
            </div>

            <!-- Register View -->
            <div id="registerView" style="display: none;">
                <h2>üìù Registrieren</h2>
                <p>Erstelle ein Konto, um deine Daten zu synchronisieren</p>

                <form id="emailRegisterForm">
                    <div class="form-group">
                        <input type="email" id="registerEmail" placeholder="E-Mail" required autocomplete="email">
                    </div>
                    <div class="form-group">
                        <input type="password" id="registerPassword" placeholder="Passwort" required autocomplete="new-password" minlength="8">
                        <div id="passwordRequirements" class="password-requirements">
                            <p>Passwort-Anforderungen:</p>
                            <ul>
                                <li id="reqLength">‚óã Mindestens 8 Zeichen</li>
                                <li id="reqUppercase">‚óã Gro√übuchstabe (A-Z)</li>
                                <li id="reqLowercase">‚óã Kleinbuchstabe (a-z)</li>
                                <li id="reqNumber">‚óã Zahl (0-9)</li>
                                <li id="reqSpecial">‚óã Sonderzeichen (!@#$...)</li>
                            </ul>
                        </div>
                    </div>
                    <div class="form-group">
                        <input type="password" id="registerPasswordConfirm" placeholder="Passwort best√§tigen" required autocomplete="new-password" minlength="8">
                    </div>
                    <div id="registerError" class="auth-error" style="display: none;"></div>
                    <button type="submit" class="btn-primary" id="registerSubmitBtn">Registrieren</button>
                </form>

                <p class="modal-footer">
                    Bereits registriert? <a href="#" id="backToLoginLink">Anmelden</a>
                </p>
            </div>

            <!-- Forgot Password View -->
            <div id="forgotPasswordView" style="display: none;">
                <h2>üîë Passwort zur√ºcksetzen</h2>
                <p>Gib deine E-Mail-Adresse ein und wir senden dir einen Link zum Zur√ºcksetzen.</p>

                <form id="forgotPasswordForm">
                    <div class="form-group">
                        <input type="email" id="resetEmail" placeholder="E-Mail" required autocomplete="email">
                    </div>
                    <div id="resetError" class="auth-error" style="display: none;"></div>
                    <div id="resetSuccess" class="auth-success" style="display: none;"></div>
                    <button type="submit" class="btn-primary" id="resetSubmitBtn">Link senden</button>
                </form>

                <p class="modal-footer">
                    <a href="#" id="backToLoginFromReset">Zur√ºck zur Anmeldung</a>
                </p>
            </div>

            <!-- Verification Sent View -->
            <div id="verificationSentView" style="display: none;">
                <div class="verification-icon">üìß</div>
                <h2>Best√§tigungs-E-Mail gesendet</h2>
                <p id="verificationEmailText">Wir haben eine Best√§tigungs-E-Mail gesendet. Bitte klicke auf den Link in der E-Mail, um dein Konto zu aktivieren.</p>
                <p class="verification-hint">Pr√ºfe auch deinen Spam-Ordner, falls du die E-Mail nicht findest.</p>
                <button class="btn-primary" id="backToLoginFromVerification">Zur Anmeldung</button>
            </div>
        </div>
    </div>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <!-- Firebase Config & Sync -->
    <script src="firebase-config.js?v=43"></script>
    <script src="sync.js?v=43"></script>

    <!-- Big 3 Plan-Auswertung -->
    <script src="plan-analysis.js?v=43"></script>

    <!-- Main App -->
    <script src="app.js?v=43"></script>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            // L√∂sche ALLE alten Caches beim Start
            window.addEventListener('load', async () => {
                try {
                    const cacheNames = await caches.keys();
                    console.log('Gefundene Caches:', cacheNames);
                    for (const cacheName of cacheNames) {
                        // L√∂sche alle alten Cache-Versionen (v1-v13)
                        if (cacheName !== 'krafttraining-v43') {
                            console.log('L√∂sche alten Cache:', cacheName);
                            await caches.delete(cacheName);
                        }
                    }
                } catch (error) {
                    console.error('Fehler beim L√∂schen alter Caches:', error);
                }

                // Service Worker registrieren
                navigator.serviceWorker.register('/service-worker.js?v=43')
                    .then(registration => {
                        console.log('Service Worker registriert:', registration);

                        // Force update sofort
                        registration.update();

                        // Pr√ºfe auf Updates alle 30 Sekunden
                        setInterval(() => {
                            registration.update();
                        }, 30000);

                        // Wenn ein Update wartet, aktiviere es sofort
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    console.log('Neuer Service Worker verf√ºgbar - Seite wird neu geladen');
                                    window.location.reload();
                                }
                            });
                        });
                    })
                    .catch(error => {
                        console.log('Service Worker Registrierung fehlgeschlagen:', error);
                    });
            });

            // Wenn der Controller sich √§ndert (neuer SW aktiv), lade die Seite neu
            let refreshing = false;
            navigator.serviceWorker.addEventListener('controllerchange', () => {
                if (!refreshing) {
                    refreshing = true;
                    console.log('Service Worker aktualisiert - Seite wird neu geladen');
                    window.location.reload();
                }
            });
        }
    </script>
</body>
</html>
